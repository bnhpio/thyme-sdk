---
title: thyme simulate
description: Validate schemas, sandbox execution, and onchain effects before deploying.
---

# `thyme simulate`

Runs a full validation pass: schema → sandbox execution → viem `simulateCalls`. Use it locally and in CI to guarantee parity with deployment bundles.

## Usage

```bash
thyme simulate stream-payout \
  --profile sepolia-test \
  --args custom-args.json \
  --env .env
```

## Options

| Flag | Description | Default | Required |
| --- | --- | --- | --- |
| `--profile <name>` | Profile defined in `untl.toml` | — | ✅ |
| `--args <file>` | Arguments file under `functions/<name>/` | `args.json` |  |
| `--env <path>` | Environment file for RPC URLs/secrets | `.env` |  |

## Execution Flow

1. Ensures `functions/<name>/index.ts`, `schema.ts`, `args.json` exist
2. Parses `schema.ts` via Zod ➜ JSON Schema
3. Validates the selected args file
4. Loads `untl.toml` and resolves env placeholders (e.g., `$SEPOLIA_RPC_URL`)
5. Compiles the function and runs it inside the Thyme sandbox (captures logs)
6. Sends resulting calls to `simulateCalls` using viem, printing receipts, gas, and revert data

## Output Signals

- **Success**: `canExec` true, simulation receipts displayed, gas summary printed
- **Schema errors**: formatted Zod stack highlighting invalid fields
- **Sandbox errors**: stack trace plus sanitized console output
- **Onchain errors**: revert reason (if available) and failing call index

## Best Practices

- Keep `args.json` deterministic so CI logs are reproducible.
- Add `thyme simulate ...` to `bun test` workflows for integration coverage.
- Use descriptive profile names (`sepolia-signer-1`) so it's clear which RPC/account combination ran the test.

