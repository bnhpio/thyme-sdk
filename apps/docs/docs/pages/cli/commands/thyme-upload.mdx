---
title: thyme upload
description: Package validated functions and deploy them to the Thyme control plane.
---

# `thyme upload`

Final deployment step. Compiles TypeScript, validates schemas, bundles artifacts, and sends them to `DEPLOY_URL` using the stored auth token.

## Usage

```bash
thyme upload stream-payout \
  --organizationId treasury \
  --env .env \
  --authToken <token> # optional override
```

## Options

| Flag | Description | Default | Required |
| --- | --- | --- | --- |
| `--organizationId`, `-o` | Target organization identifier | — | ✅ |
| `--authToken`, `-a` | Inline auth token (overrides `.env`) | — |  |
| `--env <path>` | Environment file for `DEPLOY_URL`, RPC fallbacks | `.env` |  |

## Execution Flow

1. Reuses the same validation pipeline as `thyme simulate`
2. Compiles TypeScript ➜ ESM JavaScript (respecting `tsconfig.json`)
3. Generates JSON Schema manifest from Zod definitions
4. Compresses runner, schema, args via `@bnhpio/thyme-sdk/archive`
5. Calculates checksums for integrity
6. POSTs bundle + metadata to `DEPLOY_URL` with the auth token + org ID
7. Prints deployment hash (save it for audits)

## Failure Modes

- **401/403**: expired or missing token ➜ rerun `thyme auth`
- **400**: schema mismatch / missing files ➜ rerun `thyme simulate`
- **5xx**: deployment backend issue ➜ retry after confirming partial deployments

## Best Practices

- Restrict `thyme upload` to CI jobs running on protected branches.
- Store `THYME_AUTH_TOKEN` as a short-lived secret; rotate after every release window.
- Keep `DEPLOY_URL` in `.env` (not in scripts) so staging/prod can diverge without code changes.
- Cache the compiled bundle if you build multiple variants—`thyme upload` reruns compilation, but you can pre-build with Bun to catch errors earlier.

